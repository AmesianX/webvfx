<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WebVfx: Effects Authoring</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">WebVfx&#160;<span id="projectnumber">0.1.5</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Effects Authoring </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><p>WebVfx supports both <a class="el" href="effects_authoring.html#qml_effects_authoring">QML Effects Authoring</a> and <a class="el" href="effects_authoring.html#web_effects_authoring">Web (HTML) Effects Authoring</a> for developing video effects. Both have a lot in common. WebVfx loads the effect content (HTML or QML) and exposes a JavaScript context object named <code>webvfx</code> to the effect implementation.</p>
<p>If the effect will need to access frames of video, it must set the <code>webvfx.imageTypeMap</code> property to a map describing the names it will use for each video source.</p>
<p><a class="anchor" id="image_types"></a> Each name should be mapped to one of the enumerations:</p>
<ul>
<li><code>webvfx.SourceImageType</code> Indicates the image name is the source image of a transition (the image being transitioned from), or the primary image of a filter. </li>
<li><code>webvfx.TargetImageType</code> Indicates the image name is the target image of a transition (the image being transitioned to). </li>
<li><code>webvfx.ExtraImageType</code> Indicates the image name is an extra asset. There can be multiple image names with this type.</li>
</ul>
<p>For example: </p>
<div class="fragment"><pre class="fragment">webvfx.imageTypeMap = { <span class="stringliteral">&quot;sourceImage&quot;</span> : webvfx.SourceImageType,
                        <span class="stringliteral">&quot;targetImage&quot;</span> : webvfx.TargetImageType }
</pre></div><p>The effect can request additional named parameters as part of initialization by calling <code>webvfx.getStringParameter(name)</code> or <code>webvfx.getNumberParameter(name)</code> </p>
<p>The effect must connect the <code>webvfx.renderRequested(time)</code> signal. See <a class="el" href="effects_authoring.html#qml_effects_authoring">QML Effects Authoring</a> or <a class="el" href="effects_authoring.html#web_effects_authoring">Web (HTML) Effects Authoring</a> for how to connect to this signal.</p>
<p>When the effect has fully loaded (including any external resources being loaded asynchronously), it should call: </p>
<div class="fragment"><pre class="fragment">webvfx.readyRender(<span class="keyword">true</span>)
</pre></div><p> If the load failed for any reason, pass <code>false</code> instead.</p>
<p>Now WebVfx will start rendering frames of video. It will pull the current frame from each of the video sources specified in <code>webvfx.imageTypeMap</code> then invoke the <code>webvfx.renderRequested(time)</code> signal. The time is a normalized time from 0 to 1.0 indicating the position in the transition or effect. The effect should then request any images it specified in <code>webvfx.imageTypeMap</code> each time it handles <code>renderRequested</code>. Images can be requested by calling <code>webvfx.getImage(name)</code> where <code>name</code> is the string image name specified in <code>imageTypeMap</code>. See <a class="el" href="effects_authoring.html#qml_effects_authoring">QML Effects Authoring</a> or <a class="el" href="effects_authoring.html#web_effects_authoring">Web (HTML) Effects Authoring</a> for how to use the returned image object.</p>
<p>The effect should configure itself using the <code>time</code> value and the images it retrieved before returning from the <code>renderRequested</code> slot.</p>
<h2><a class="anchor" id="qml_effects_authoring"></a>
QML Effects Authoring</h2>
<p>Effects can be authored using QtQuick <a href="http://doc.qt.nokia.com/latest/qtquick.html">QML</a>, a declarative UI language.</p>
<p>The <code>webvfx.renderRequested(time)</code> signal can be handled using the QML <a href="http://doc.qt.nokia.com/latest/qml-connections.html">Connections</a> element with <code>webvfx</code> as the target. The <code>time</code> parameter is available to the code, e.g.: </p>
<div class="fragment"><pre class="fragment">Connections {
    target: webvfx
    onRenderRequested: {
        effect.textureImage = webvfx.getImage(<span class="stringliteral">&quot;sourceImage&quot;</span>);
        console.log(<span class="stringliteral">&quot;render: &quot;</span> + time);
    }
}
</pre></div><p>Video frame images retrieved via <code>webvfx.getImage(name)</code> are QImage objects. These can be assigned directly to some QML properties, e.g. <a href="http://doc.qt.nokia.com/qt-quick3d-snapshot/qml-effect.html#textureImage-prop">Effect.textureImage</a>. Other QML properties require an image URL - this can be retrived via <code>webvfx.getImageUrl(name)</code>. It is more efficient to use the image directly when possible, instead of the URL.</p>
<dl class="see"><dt><b>See also:</b></dt><dd>See the QML demo <a class="el" href="examples_2filter-demo_8qml-example.html">demo/examples/filter-demo.qml</a></dd></dl>
<p>QML is more interesting as a video effects technology when it is extended with 3D support - see <a class="el" href="effects_3d.html">3D Effects Authoring</a>.</p>
<h2><a class="anchor" id="web_effects_authoring"></a>
Web (HTML) Effects Authoring</h2>
<p>Effects can be authored using <a href="http://doc.qt.nokia.com/latest/qtwebkit.html">QtWebKit</a> HTML.</p>
<p>The <code>webvfx.renderRequested(time)</code> signal can be handled by connecting it to a JavaScript function that takes a <code>time</code> parameter, using <code>webvfx.renderRequested.connect</code>: </p>
<div class="fragment"><pre class="fragment">function render(time) {
   console.log(<span class="stringliteral">&quot;render: &quot;</span> + time);
}
webvfx.renderRequested.connect(render);
</pre></div><p><code>webvfx.getImage(name)</code> returns a JavaScript image proxy object for the current frame of video for the named image. This must be assigned to a DOM <code>Image</code> element so that it can be used in the HTML. The <a href="http://doc.qt.nokia.com/latest/qtwebkit-bridge.html">QtWebKit Bridge</a> provides a method <code>assignToHTMLImageElement()</code> to do this. You can assign to a new <code>Image:</code> </p>
<div class="fragment"><pre class="fragment">var image = <span class="keyword">new</span> Image()
webvfx.getImage(&quot;sourceImage&quot;).assignToHTMLImageElement(image);
</pre></div><p> or reference an existing one in the DOM </p>
<div class="fragment"><pre class="fragment">&lt;img <span class="keywordtype">id</span>=<span class="stringliteral">&quot;image&quot;</span>/&gt;
[...]
webvfx.getImage(<span class="stringliteral">&quot;sourceImage&quot;</span>).assignToHTMLImageElement(document.getElementById(<span class="stringliteral">&quot;image&quot;</span>));
</pre></div><dl class="see"><dt><b>See also:</b></dt><dd>See the HTML demos: <ul>
<li><a class="el" href="examples_2producer-demo_8html-example.html">demo/examples/producer-demo.html</a> </li>
<li><a class="el" href="examples_2filter-demo_8html-example.html">demo/examples/filter-demo.html</a> </li>
<li><a class="el" href="examples_2transition-demo_8html-example.html">demo/examples/transition-demo.html</a></li>
</ul>
</dd></dl>
<h2><a class="anchor" id="effects_authoring_tools"></a>
Tools</h2>
<p>A couple of simple tools are provided to help authoring effects.</p>
<p><code>webvfx_browser</code> (<code>WebVfx Browser.app</code> on MacOS) is a trivial wrapper around QtWebKit. This makes it easy to visit any website and see if the version of QtWebKit you are using supports various HTML features.</p>
<p><code>webvfx_viewer</code> (<code>WebVfx Viewer.app</code> on MacOS) allows you to load your HTML or QML effects and exposes the <code>webvfx</code> context object to them, and generates images that your effect can request using <code>webvfx.getImage(name)</code>. It has a slider along the bottom that lets you control the rendering time (0..1.0) and a tab to let you set the rendering size. </p>
</div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/>
<address class="footer"><small>Generated on Mon May 9 2011 16:04:31 for WebVfx using <a href="http://www.doxygen.org">Doxygen 1.7.3</a></small></address>
<address class="footer"><small>Copyright (c) 2011 Hewlett-Packard Development Company, L.P. All rights reserved. Use of this source code is governed by a BSD-style license that can be found in the LICENSE file.</small></address>
</body>
</html>
